<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Werewolf Game Setup</title>
    <link rel="stylesheet" href="styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode-generator@1.4.4/qrcode.min.js"></script>
    <script>
      // Check if QRCode library loaded successfully
      window.addEventListener("load", function () {
        if (typeof QRCode === "undefined") {
          console.error("QRCode library failed to load from primary CDN");
          // Try alternative CDN
          const script = document.createElement("script");
          script.src =
            "https://cdnjs.cloudflare.com/ajax/libs/qrcode/1.5.3/qrcode.min.js";
          script.onload = function () {
            console.log("QRCode library loaded from alternative CDN");
          };
          script.onerror = function () {
            console.error("Failed to load QRCode library from alternative CDN");
            // Try third CDN
            const script2 = document.createElement("script");
            script2.src = "https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js";
            script2.onload = function () {
              console.log("QRCode library loaded from unpkg CDN");
            };
            script2.onerror = function () {
              console.error("All QRCode CDNs failed");
            };
            document.head.appendChild(script2);
          };
          document.head.appendChild(script);
        } else {
          console.log("QRCode library loaded successfully from primary CDN");
        }
      });
    </script>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>🐺 Werewolf Game Setup</h1>
        <p>Configure your game and generate player links</p>
      </header>

      <form id="gameSetupForm" class="setup-form">
        <!-- Basic Game Settings -->
        <div class="form-group">
          <label for="playerCount">Number of Players:</label>
          <input
            type="number"
            id="playerCount"
            min="6"
            max="20"
            value="8"
            required
          />
        </div>

        <div class="form-group">
          <label for="werewolfCount">Number of Werewolves:</label>
          <input
            type="number"
            id="werewolfCount"
            min="1"
            max="4"
            value="2"
            required
          />
        </div>

        <!-- Role Inputs Grid -->
        <div class="role-inputs-grid">
          <div class="role-input-group">
            <label for="seerCount">
              <span class="role-icon">🔮</span>
              Number of Seers:
            </label>
            <input
              type="number"
              id="seerCount"
              min="0"
              max="2"
              value="1"
              required
            />
          </div>

          <div class="role-input-group">
            <label for="doctorCount">
              <span class="role-icon">🏥</span>
              Number of Doctors:
            </label>
            <input
              type="number"
              id="doctorCount"
              min="0"
              max="1"
              value="0"
              required
            />
          </div>

          <div class="role-input-group">
            <label for="bodyguardCount">
              <span class="role-icon">🛡️</span>
              Number of Bodyguards:
            </label>
            <input
              type="number"
              id="bodyguardCount"
              min="0"
              max="1"
              value="0"
              required
            />
          </div>

          <div class="role-input-group">
            <label for="cupidCount">
              <span class="role-icon">💕</span>
              Number of Cupids:
            </label>
            <input
              type="number"
              id="cupidCount"
              min="0"
              max="1"
              value="0"
              required
            />
          </div>

          <div class="role-input-group">
            <label for="wolfCubCount">
              <span class="role-icon">🐺</span>
              Number of Wolf Cubs:
            </label>
            <input
              type="number"
              id="wolfCubCount"
              min="0"
              max="1"
              value="0"
              required
            />
          </div>

          <div class="role-input-group">
            <label for="alphaWolfCount">
              <span class="role-icon">👑</span>
              Number of Alpha Wolves:
            </label>
            <input
              type="number"
              id="alphaWolfCount"
              min="0"
              max="1"
              value="0"
              required
            />
          </div>

          <div class="role-input-group">
            <label for="sorceressCount">
              <span class="role-icon">🔮</span>
              Number of Sorceresses:
            </label>
            <input
              type="number"
              id="sorceressCount"
              min="0"
              max="1"
              value="0"
              required
            />
          </div>

          <div class="role-input-group">
            <label for="lycanCount">
              <span class="role-icon">🌙</span>
              Number of Lycans:
            </label>
            <input
              type="number"
              id="lycanCount"
              min="0"
              max="1"
              value="0"
              required
            />
          </div>

          <div class="role-input-group">
            <label for="witchCount">
              <span class="role-icon">🧙‍♀️</span>
              Number of Witches:
            </label>
            <input
              type="number"
              id="witchCount"
              min="0"
              max="1"
              value="0"
              required
            />
          </div>

          <div class="role-input-group">
            <label for="detectiveCount">
              <span class="role-icon">🔍</span>
              Number of Detectives:
            </label>
            <input
              type="number"
              id="detectiveCount"
              min="0"
              max="1"
              value="0"
              required
            />
          </div>

          <div class="role-input-group">
            <label for="revealerCount">
              <span class="role-icon">📢</span>
              Number of Revealers:
            </label>
            <input
              type="number"
              id="revealerCount"
              min="0"
              max="1"
              value="0"
              required
            />
          </div>

          <div class="role-input-group">
            <label for="piCount">
              <span class="role-icon">🕵️</span>
              Number of PIs:
            </label>
            <input
              type="number"
              id="piCount"
              min="0"
              max="1"
              value="0"
              required
            />
          </div>

          <div class="role-input-group">
            <label for="tannerCount">
              <span class="role-icon">🎭</span>
              Number of Tanners:
            </label>
            <input
              type="number"
              id="tannerCount"
              min="0"
              max="1"
              value="0"
              required
            />
          </div>

          <div class="role-input-group">
            <label for="hunterCount">
              <span class="role-icon">🏹</span>
              Number of Hunters:
            </label>
            <input
              type="number"
              id="hunterCount"
              min="0"
              max="1"
              value="0"
              required
            />
          </div>
        </div>

        <div class="form-group">
          <label>
            <input type="checkbox" id="usePlayerNames" /> Use Player Names
            (Optional)
          </label>
        </div>

        <div
          id="playerNamesContainer"
          class="player-names-container"
          style="display: none"
        >
          <h3>Player Names</h3>
          <div id="playerNamesList"></div>
        </div>

        <button type="submit" class="btn btn-primary">Generate Game</button>
        <button
          type="button"
          id="testQRBtn"
          class="btn btn-secondary"
          style="margin-left: 1rem"
        >
          Test QR Code
        </button>
        <button
          type="button"
          id="roleGuideBtn"
          class="btn btn-info"
          style="margin-left: 1rem"
        >
          ❓ Role Guide
        </button>
      </form>

      <!-- Timer Section -->
      <div class="timer-section">
        <h3>⏱️ Game Timer</h3>
        <div class="timer-controls">
          <div class="timer-input">
            <label for="timerMinutes">Minutes:</label>
            <input
              type="number"
              id="timerMinutes"
              min="1"
              max="120"
              value="15"
              style="width: 80px; margin-right: 1rem"
            />
            <label for="timerSeconds">Seconds:</label>
            <input
              type="number"
              id="timerSeconds"
              min="0"
              max="59"
              value="0"
              style="width: 80px"
            />
          </div>
          <div class="timer-buttons">
            <button id="startTimerBtn" class="btn btn-success">Start Timer</button>
            <button id="pauseTimerBtn" class="btn btn-warning" style="display: none">Pause</button>
            <button id="resetTimerBtn" class="btn btn-secondary">Reset</button>
          </div>
        </div>
        <div id="timerDisplay" class="timer-display" style="display: none">
          <span id="timerTime">15:00</span>
        </div>
      </div>

      <!-- Notes Section -->
      <div class="notes-section">
        <h3>📝 Game Notes</h3>
        <textarea
          id="gameNotes"
          placeholder="Write your game notes here... (e.g., player suspicions, night actions, etc.)"
          rows="6"
          style="width: 100%; margin-bottom: 1rem"
        ></textarea>
        <div class="notes-buttons">
          <button id="saveNotesBtn" class="btn btn-primary">Save Notes</button>
          <button id="clearNotesBtn" class="btn btn-secondary">Clear Notes</button>
        </div>
      </div>
      </form>

      <div id="gameResults" class="game-results" style="display: none">
        <h2>Player QR Codes</h2>
        <p class="qr-instructions">
          Scan each QR code with your phone to view your role. Each player
          should scan their own QR code to see their assigned role.
        </p>
        <div id="playerLinks" class="player-links"></div>

        <div class="game-info">
          <h3>Game Summary</h3>
          <div id="gameSummary" class="game-summary"></div>
        </div>

        <div class="role-assignments" style="display: none">
          <h3>Role Assignments</h3>
          <p class="role-assignments-note">
            Each player's assigned role (order does not reflect role assignment
            order):
          </p>
          <div id="roleAssignments" class="role-assignments-list"></div>
        </div>

        <div class="role-assignments-controls">
          <button id="showRoleAssignmentsBtn" class="btn btn-secondary">
            Show Role Assignments
          </button>
        </div>
      </div>

      <!-- Game Tracking System -->
      <div id="gameTracking" class="game-tracking" style="display: none">
        <h2>🎮 Game Tracking</h2>
        
        <!-- Player Status Tracking -->
        <div class="tracking-grid">
          <div class="tracking-section">
            <h3>👥 Player Status</h3>
            <div id="playerStatusList" class="player-status-list">
              <!-- Player status items will be generated here -->
            </div>
          </div>

          <div class="tracking-section">
            <h3>📊 Game Statistics</h3>
            <div id="gameStats">
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div style="background: #e8f5e8; padding: 1rem; border-radius: 8px; text-align: center;">
                  <div style="font-size: 2rem; font-weight: bold; color: #4caf50;" id="aliveCount">0</div>
                  <div style="font-size: 0.9rem; color: #666;">Alive</div>
                </div>
                <div style="background: #ffeaea; padding: 1rem; border-radius: 8px; text-align: center;">
                  <div style="font-size: 2rem; font-weight: bold; color: #f44336;" id="deadCount">0</div>
                  <div style="font-size: 0.9rem; color: #666;">Dead</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Night Actions Tracking -->
        <div class="night-actions">
          <h3>🌙 Night Actions</h3>
          <div class="action-form">
            <select id="actionType">
              <option value="">Select Action Type</option>
              <option value="attack">Werewolf Attack</option>
              <option value="save">Doctor Save</option>
              <option value="investigate">Seer Investigation</option>
              <option value="protect">Bodyguard Protection</option>
              <option value="witch-save">Witch Save</option>
              <option value="witch-kill">Witch Kill</option>
              <option value="hunter-kill">Hunter Kill</option>
              <option value="other">Other</option>
            </select>
            <select id="actionPerformer">
              <option value="">Performer</option>
              <!-- Will be populated with alive players -->
            </select>
            <select id="actionTarget">
              <option value="">Target</option>
              <!-- Will be populated with alive players -->
            </select>
            <button type="button" id="addActionBtn" class="btn btn-primary">Add Action</button>
          </div>
          <div id="actionsList" class="actions-list">
            <!-- Actions will be listed here -->
          </div>
        </div>

        <!-- Lovers Tracking (only shown if Cupid is in game) -->
        <div id="loversSection" class="lovers-section" style="display: none;">
          <h3>💕 Lovers</h3>
          <div id="loversList">
            <!-- Lovers pairs will be listed here -->
          </div>
          <div style="margin-top: 1rem;">
            <button id="addLoversBtn" class="btn btn-primary">Add Lovers Pair</button>
          </div>
        </div>

        <!-- Game Phase Tracking -->
        <div style="background: white; padding: 1.5rem; border-radius: 12px; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); border: 1px solid #e0e0e0; margin-top: 2rem;">
          <h3 style="color: var(--dark-color); margin-bottom: 1rem; font-size: 1.2rem;">🔄 Game Phase</h3>
          <div style="display: flex; gap: 1rem; align-items: center;">
            <button id="nextPhaseBtn" class="btn btn-success">Next Phase</button>
            <span id="currentPhase" style="font-weight: 600; color: var(--primary-color);">Night 1</span>
            <button id="resetPhaseBtn" class="btn btn-secondary">Reset Phase</button>
          </div>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
  </body>
</html>
